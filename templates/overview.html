{% extends "base.html" %}
{% block body %}
<div class="container">
  <div class="layout">
    <aside class="sidebar">
      <button class="btn small block" data-sidebar-toggle type="button">Toggle Sidebar</button>

      <h4>Navigation</h4>
      <a class="side-item active" href="{{ url_for('overview') }}"><span class="label">üè† Overview</span><span class="badge">LIVE</span></a>
      <a class="side-item" href="{{ url_for('servers') }}"><span class="label">üñ• Servers</span><span class="badge">2</span></a>
      <a class="side-item" href="{{ url_for('reports') }}"><span class="label">üßæ Reports</span><span class="badge">{{ stats.reports_today }}</span></a>
      <a class="side-item" href="{{ url_for('settings') }}"><span class="label">‚öôÔ∏è Settings</span><span class="badge">CFG</span></a>

      <div class="sidebar-bottom">
        <div class="profile">
          <div class="avatar"></div>
          <div class="meta">
            <b>{{ user.username }}</b>
            <small>Owner</small>
          </div>
        </div>
        <a class="btn block danger" href="{{ url_for('logout') }}">Logout</a>
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title">
          <h2>Dashboard</h2>
          <p>Server: <span class="kbd">{{ active_guild.name }}</span></p>
        </div>
        <div class="guild-chip">
          <div class="gicon"></div>
          <div>
            <b>{{ active_guild.name }}</b>
            <small>Active guild</small>
          </div>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Servers</h3>
          <div class="big">{{ stats.servers }}</div>
          <div class="sub">This dashboard context</div>
        </div>
        <div class="card">
          <h3>Members</h3>
          <div class="big">{{ stats.members }}</div>
          <div class="sub">Requires bot wiring later</div>
        </div>
        <div class="card">
          <h3>Reports Today</h3>
          <div class="big">{{ stats.reports_today }}</div>
          <div class="sub">From real logged events</div>
        </div>
        <div class="card">
          <h3>Tickets Open</h3>
          <div class="big">{{ stats.tickets_open }}</div>
          <div class="sub">Also event-driven</div>
        </div>
        <div class="card">
          <h3>Status</h3>
          <div class="status {% if stats.status != 'Online' %}warn{% endif %}">
            <span class="led"></span>{{ stats.status }}
          </div>
          <div class="sub">OAuth token: {% if session.get("discord_token") %}OK{% else %}Missing{% endif %}</div>
        </div>
      </div>

      <div class="two-col">
        <div class="card">
          <h3>Quick Actions</h3>
          <div class="actions">
            <form method="post" action="{{ url_for('do_action', action_name='create_invite') }}">
              <button class="btn block" type="submit">Create Invite</button>
            </form>
            <form method="post" action="{{ url_for('do_action', action_name='sync_roles') }}">
              <button class="btn block" type="submit">Sync Roles</button>
            </form>
            <form method="post" action="{{ url_for('do_action', action_name='run_audit') }}">
              <button class="btn block" type="submit">Run Audit</button>
            </form>
            <form method="post" action="{{ url_for('do_action', action_name='post_announcement') }}">
              <button class="btn block primary" type="submit">Post Announcement</button>
            </form>

            <div class="hint">These are UI-only for now. They still create real audit logs.</div>
          </div>
        </div>

        <div class="card">
          <h3>Weekly Joins</h3>
          <div class="spark" title="Fake visualization, real dopamine.">
            <span></span><span></span><span></span><span></span><span></span><span></span><span></span>
          </div>
          <div class="sub">We‚Äôll replace this with real bot stats later.</div>
        </div>
      </div>

      <div class="hr"></div>

      <div class="card">
        <h3>Recent Activity</h3>
        {% if not events %}
          <div class="note">No events yet. Press some buttons. I dare you.</div>
        {% else %}
          <table class="table">
            <thead>
              <tr>
                <th>Time</th><th>Actor</th><th>Action</th><th>Detail</th>
              </tr>
            </thead>
            <tbody>
              {% for e in events %}
              <tr>
                <td><span class="tag">{{ e.created_at }}</span></td>
                <td>{{ e.actor }}</td>
                <td><span class="tag good">{{ e.action }}</span></td>
                <td>{{ e.detail }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    </main>
  </div>
</div>
{% endblock %}