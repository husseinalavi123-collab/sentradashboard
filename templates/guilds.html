{% extends "base.html" %}
{% block body %}
<div class="container">
  <div class="layout">
    <aside class="sidebar">
      <button class="btn small block" data-sidebar-toggle type="button">Toggle Sidebar</button>

      <h4>Account</h4>
      <div class="profile">
        <div class="avatar"></div>
        <div class="meta">
          <b>{{ user.username }}</b>
          <small>Discord login</small>
        </div>
      </div>

      <div class="sidebar-bottom">
        {% if discord_ready and install_url %}
          <a class="btn block primary" href="{{ install_url }}" target="_blank" rel="noreferrer">Add bot to server</a>
        {% else %}
          <div class="note">Install requires Discord OAuth env vars on Render.</div>
        {% endif %}
      </div>
    </aside>

    <main class="main">
      <div class="header-row">
        <div class="title">
          <h2>Select a Server</h2>
          <p>Only servers where you have <span class="kbd">Manage Server</span> permission show up.</p>
        </div>
      </div>

      {% if not guilds %}
        <div class="note">
          No manageable servers found. Either you don’t have Manage Server permission anywhere,
          or Discord didn’t return your guild list.
        </div>
      {% endif %}

      <div class="guild-grid">
        {% for g in guilds %}
        <div class="guild-card">
          <div class="left">
            <div class="icon"></div>
            <div>
              <b>{{ g.name }}</b>
              <small>Guild ID: {{ g.id }}</small>
            </div>
          </div>
          <a class="btn primary" href="{{ url_for('select_guild', guild_id=g.id) }}">Configure</a>
        </div>
        {% endfor %}
      </div>
    </main>
  </div>
</div>
{% endblock %}